<%- include('partials/header') %>
<%- include('partials/_flash') %>
<div class="container mx-auto p-6">
  <h1 class="text-3xl font-bold mb-6">Your Cart</h1>

  <% if (user.cart.length === 0) { %>
    <p class="text-gray-600">
      Your cart is empty. <a href="/restaurants" class="text-blue-600 underline">Browse Restaurants</a>
    </p>
  <% } else { %>
    <% let total = 0; %>

    <div class="space-y-6">
      <% user.cart.forEach(item => { %>
        <% const restaurant = item.restaurant; %>
        <% const food = item.food; %>
        <% const subtotal = food.price * item.quantity; %>
        <% total += subtotal; %>

        <div class="bg-white p-4 shadow rounded-lg">
          <h2 class="text-xl font-semibold mb-2"><%= restaurant.name || restaurant["Restaurant Name"] %></h2>
          <p class="text-gray-700">Location: <%= restaurant.location || restaurant["Location"] %></p>

          <div class="mt-4 flex justify-between items-center">
            <div>
              <p class="text-lg font-medium"><%= food.name %></p>
              <p class="text-gray-600">Price: $<%= food.price %></p>
              <p class="text-gray-600">Quantity: <%= item.quantity %></p>
              <p class="text-gray-800 font-semibold mt-1">Subtotal: $<%= subtotal.toFixed(2) %></p>
            </div>

             <div class="flex items-center gap-2 mt-3">
              
              <form action="/cart/update/<%= item._id %>" method="POST">
                <input type="hidden" name="action" value="reduce">
                <button
                  class="w-8 h-8 text-xl font-bold text-white bg-red-500 rounded-full hover:bg-red-600 disabled:opacity-50"
                  <% if (item.quantity <= 1) { %> disabled <% } %>
                >âˆ’</button>
              </form>
              <div class="min-w-[2rem] text-center font-semibold text-gray-800">
                <%= item.quantity %>
              </div>

              <!-- Add button -->
              <form action="/cart/update/<%= item._id %>" method="POST">
                <input type="hidden" name="action" value="add">
                <button
                  class="w-8 h-8 text-xl font-bold text-white bg-green-500 rounded-full hover:bg-green-600"
                >+</button>
              </form>
            </div>


            <form action="/cart/remove/<%= item._id %>" method="POST">
              <button class="px-3 py-1 bg-red-500 rounded text-white hover:bg-red-600">Remove</button>
            </form>
          </div>
        </div>
      <% }) %>
    </div>

    <!-- Total Price -->
    <div class="mt-8 text-right">
      <p class="text-2xl font-bold">Total: $<%= total.toFixed(2) %></p>
    </div>
    <form action="/checkout" method="GET" class="mt-6">
  <button class="w-full bg-indigo-600 text-white py-3 px-6 rounded-lg text-lg font-semibold hover:bg-indigo-700">
    Proceed to Checkout
  </button>
</form>
  <% } %>
</div>

<%- include('partials/footer') %>
