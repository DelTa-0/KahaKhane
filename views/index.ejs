<!-- views/home.ejs -->
<%- include('partials/header', { title: 'Home - Foodie' }) %>
<%- include('partials/_flash') %>

<main class="min-h-screen flex items-center justify-center bg-gray-50 px-4 py-12">
  <div class="max-w-2xl w-full space-y-8 text-center">
    <h3 class="text-4xl">welcome to <span class="text-blue-400 font-semibold">KahaKhane</span></h3>
    <h1 class="text-4xl sm:text-5xl font-extrabold text-indigo-700">Find the Best Restaurants Near You</h1>

    <form action="/restaurant/search" method="GET" class="space-y-4">
      <div class="flex flex-col sm:flex-row gap-3">
        <input
          name="query"
          type="search"
          placeholder="Search for restaurants or dishes"
          class="w-full border border-gray-300 rounded-lg px-5 py-3 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
          required
        />
        <input
          name="location"
          type="text"
          placeholder="Enter your location"
          class="w-full border border-gray-300 rounded-lg px-5 py-3 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
        />
      </div>

      <div class="w-full sm:flex-row gap-3">
        <div class="flex flex-col sm:flex-row gap-3">
        <input
          name="price"
          type="search"
          placeholder="enter max price"
          class="w-full border border-gray-300 rounded-lg px-5 py-3 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
          required
        />
      </div>

       <input type="hidden" name="lat" id="lat">
<input type="hidden" name="lng" id="lng">

<button
  type="button"
  id="getLocationBtn"
  class="inline-block bg-green-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-green-700 transition"
>
  Use My Location
</button>
        <button
          type="submit"
          class="w-full mt-2 sm:w-auto bg-indigo-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-indigo-700 transition-colors"
        >
          Search
        </button>
        
      </div>
    </form>

    <div class="mt-6">
      
    </div>
  </div>

 <script>
  const getLocationBtn = document.getElementById('getLocationBtn');
  const latInput = document.getElementById('lat');
  const lngInput = document.getElementById('lng');
  const searchForm = document.querySelector('form');

  getLocationBtn.addEventListener('click', () => {
    if (!navigator.geolocation) {
      alert('Geolocation is not supported by your browser.');
      return;
    }

    getLocationBtn.textContent = 'Getting location‚Ä¶';
    getLocationBtn.disabled = true;

    navigator.geolocation.getCurrentPosition(
      (position) => {
        // ‚úÖ Got location
        latInput.value = position.coords.latitude;
        lngInput.value = position.coords.longitude;

        alert('üìç Location detected! Searching nearby restaurants‚Ä¶');
        // ‚úÖ Auto-submit the form with coordinates
        searchForm.submit();
      },
      (error) => {
        // ‚ùå Error occurred
        console.error('Geolocation error:', error);
        switch (error.code) {
          case error.PERMISSION_DENIED:
            alert('‚ùå You denied the location request.');
            break;
          case error.POSITION_UNAVAILABLE:
            alert('‚ùå Location information is unavailable.');
            break;
          case error.TIMEOUT:
            alert('‚ùå Location request timed out.');
            break;
          default:
            alert('‚ùå An unknown error occurred.');
            break;
        }
        getLocationBtn.textContent = 'Use My Location';
        getLocationBtn.disabled = false;
      }
    );
  });
</script>



</main>

<%- include('partials/footer') %>
